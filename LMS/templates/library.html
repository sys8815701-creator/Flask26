{% extends 'layout.html' %}
{% block content %}
<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>ğŸ“‚ ìë£Œì‹¤</h2>
        <a href="/" class="btn btn-secondary btn-sm">ë©”ì¸ìœ¼ë¡œ</a>
    </div>

    <div class="card mb-4 shadow-sm border-0">
        <div class="card-body">
            <h5 class="card-title mb-3">íŒŒì¼ ì—…ë¡œë“œ</h5>
            <form action="/library/upload" method="post" enctype="multipart/form-data">
                <div class="mb-3">
                    <input type="file" name="file" class="form-control" id="fileInput" onchange="previewFile()" required>
                </div>
                <div id="previewContainer" class="mb-3 d-none">
                    <p class="text-muted small mb-1">ì—…ë¡œë“œ ì˜ˆì • íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°:</p>
                    <div id="filePreview" class="border rounded p-2 bg-light text-center" style="max-height: 200px; overflow: hidden;">
                        </div>
                </div>
                <button type="submit" class="btn btn-primary w-100">ì„œë²„ì— ì €ì¥í•˜ê¸°</button>
            </form>
        </div>
    </div>

    <div class="card shadow-sm border-0">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th style="width: 10%">ë²ˆí˜¸</th>
                        <th>íŒŒì¼ëª…</th>
                        <th style="width: 30%" class="text-center">ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody>
                    {% for file in files %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td class="text-truncate" style="max-width: 300px;">{{ file }}</td>
                        <td class="text-center">
                            <div class="btn-group">
                                <a href="{{ url_for('static', filename='uploads/' + file) }}" class="btn btn-sm btn-outline-success" download>ë‹¤ìš´ë¡œë“œ</a>
                                <form action="{{ url_for('library_delete', filename=file) }}" method="post" onsubmit="return confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?');" style="display:inline;">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">ì‚­ì œ</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="3" class="text-center py-5 text-muted">ë“±ë¡ëœ ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
function previewFile() {
    const preview = document.getElementById('filePreview');
    const container = document.getElementById('previewContainer');
    const file = document.getElementById('fileInput').files[0];
    const reader = new FileReader();

    container.classList.remove('d-none');
    preview.innerHTML = ""; // ì´ì „ ë¯¸ë¦¬ë³´ê¸° ì´ˆê¸°í™”

    reader.onloadend = function () {
        if (file.type.startsWith('image/')) {
            // ì´ë¯¸ì§€ì¸ ê²½ìš° ì´ë¯¸ì§€ë¥¼ ë³´ì—¬ì¤Œ
            const img = document.createElement('img');
            img.src = reader.result;
            img.style.maxWidth = "100%";
            img.style.maxHeight = "180px";
            preview.appendChild(img);
        } else {
            // ì´ë¯¸ì§€ê°€ ì•„ë‹Œ ê²½ìš° íŒŒì¼ ì •ë³´ë§Œ í‘œì‹œ
            preview.innerHTML = `<div class="py-3">ğŸ“„ <strong>${file.name}</strong><br><span class="text-muted">${(file.size / 1024).toFixed(1)} KB</span></div>`;
        }
    }

    if (file) {
        reader.readAsDataURL(file);
    }
}
</script>
{% endblock %}